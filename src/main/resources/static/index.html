<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML Workflow Editor</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/jsplumb@2.15.0/dist/js/jsplumb.min.js"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div id="app">
    <div class="toolbar">
        <div class="file-info">
            <span class="file-name">{{ diagramName }}</span>
            <span :class="['save-status', {saved: isSaved}]">
                {{ isSaved ? '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ' : '‚óè –ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' }}
            </span>
        </div>

        <div class="tools">
            <button class="shape-btn process-btn" @click="addNode('process')" title="–ü—Ä–æ—Ü–µ—Å—Å"></button>
            <button class="shape-btn decision-btn" @click="addNode('decision')" title="–†–µ—à–µ–Ω–∏–µ"></button>
            <button class="shape-btn terminal-btn" @click="addNode('terminal')" title="–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä"></button>
            <button @click="deleteSelectedNode" title="–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç">üóëÔ∏è</button>
            <button @click="saveDiagram" :disabled="isSaved" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    <div class="editor" ref="editor"></div>

    <div v-if="showEditor" class="modal">
        <div class="modal-content">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–∞</h2>

            <div v-if="editingNode">
                <div v-if="editingNode.id === '@START'">
                    <h3>–ù–∞—á–∞–ª—å–Ω—ã–π —É–∑–µ–ª (–¥–∏–∞–ª–æ–≥)</h3>

                    <label>–¢–∞–π–º–∞—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–µ–∫):
                        <input type="number" v-model="editingDialog.message_timeout">
                    </label>

                    <h4>–ö–æ–º–∞–Ω–¥—ã:</h4>
                    <div v-for="(command, index) in editingDialog.commands" :key="index">
                        <label>–û—Ç–≤–µ—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):
                            <input type="text" v-model="command.answerStr">
                        </label>
                        <label>–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É:
                            <select v-model="command.node_to">
                                <option v-for="node in nodes" :value="node.id">{{ node.id }}</option>
                            </select>
                        </label>
                        <button @click="removeCommand(index)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <button @click="addCommand">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
                </div>

                <div v-else-if="editingNode.type === 'terminal'">
                    <h3>{{ editingNode.id === '@START' ? '@START' : '@END' }}</h3>
                    <label>–¢–µ–∫—Å—Ç:
                        <input type="text" v-model="editingNode.text">
                    </label>
                    <div v-if="editingNode.id !== '@START'">
                        <label>–£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:
                            <input type="checkbox" v-model="editingNode.success_ending">
                        </label>
                    </div>
                </div>

                <div v-else-if="editingNode.type === 'process'">
                    <h3>–ü—Ä–æ—Ü–µ—Å—Å</h3>
                    <label>ID —É–∑–ª–∞:
                        <input type="text" v-model="editingNode.id">
                    </label>
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:
                        <input type="text" v-model="editingNode.title">
                    </label>
                    <label>–¢–µ–∫—Å—Ç:
                        <textarea v-model="editingNode.text" class="rich-text-editor"></textarea>
                    </label>
                    <label>–¢–∞–π–º–∞—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–µ–∫):
                        <input type="number" v-model="editingNode.message_timeout">
                    </label>
                    <label>–¢–∏–ø –∫–æ–Ω—Ç–∞–∫—Ç–∞:
                        <input type="text" v-model="editingNode.contact_type">
                    </label>
                    <label>–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É:
                        <select v-model="editingNode.node_to">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª --</option>
                            <option v-for="node in availableTargetNodes(editingNode.id)" :value="node.id">{{ node.id }}</option>
                        </select>
                    </label>
                </div>

                <div v-else-if="editingNode.type === 'decision'">
                    <h3>–†–µ—à–µ–Ω–∏–µ</h3>
                    <label>ID —É–∑–ª–∞:
                        <input type="text" v-model="editingNode.id">
                    </label>
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:
                        <input type="text" v-model="editingNode.title">
                    </label>
                    <label>–¢–µ–∫—Å—Ç:
                        <textarea v-model="editingNode.text" class="rich-text-editor"></textarea>
                    </label>
                    <label>–¢–∞–π–º–∞—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–µ–∫):
                        <input type="number" v-model="editingNode.message_timeout">
                    </label>
                    <label>–¢–∏–ø –∫–æ–Ω—Ç–∞–∫—Ç–∞:
                        <input type="text" v-model="editingNode.contact_type">
                    </label>

                    <h4>–û–ø—Ü–∏–∏:</h4>
                    <div v-if="editingNode.options">
                        <div v-for="(option, index) in editingNode.options" :key="index">
                            <label>–û—Ç–≤–µ—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):
                                <input type="text" v-model="option.answerStr">
                            </label>
                            <label>–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É:
                                <select v-model="option.node_to">
                                    <option v-for="node in nodes" :value="node.id">{{ node.id }}</option>
                                </select>
                            </label>
                            <button @click="removeOption(index)">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <button @click="addOption">–î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏—é</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button @click="saveNodeChanges">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button @click="closeEditor">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
</div>
<script src="/js/app.js"></script>
</body>
</html>